# sw-cli Integration Guide

## Overview

All CLIs generated by cli-gen integrate with the [sw-cli](https://github.com/softwarewrighter/sw-cli) library to provide standardized version information, help text management, and build metadata.

## How It Works

### 1. Git Submodule Approach

Generated projects use sw-cli as a git submodule rather than a crates.io dependency:

```
<project>/
└── lib/
    └── sw-cli/          # Git submodule
```

**Benefits:**
- Always use the latest sw-cli features
- Easy to update via `git submodule update --remote`
- No dependency on crates.io publication
- Direct integration with upstream changes

### 2. Build-Time Code Generation

The `build.rs` file uses sw-cli macros to generate code at build time:

```rust
fn main() {
    sw_cli::define_build_info!();
    sw_cli::define_help_info!();
}
```

**`define_build_info!()`** generates:
- `VERSION` - From Cargo.toml
- `COPYRIGHT` - From COPYRIGHT file
- `LICENSE_NAME` - From Cargo.toml
- `LICENSE_URL` - Constructed from repository URL
- `BUILD_HOST` - Hostname where build occurred
- `GIT_COMMIT_SHA` - Current git commit
- `BUILD_TIMESTAMP` - Unix timestamp of build

**`define_help_info!()`** generates:
- `SHORT_HELP` - From `src/short-help.txt`
- `LONG_HELP` - From `src/long-help.txt`

### 3. Runtime Usage

In `main.rs`, the generated version information is used:

```rust
use clap::Parser;
use my_cli::cli::Cli;

fn main() {
    // Early version check before full parsing
    let args: Vec<String> = std::env::args().collect();
    if args.len() > 1 && (args[1] == "-V" || args[1] == "--version") {
        println!("{}", sw_cli::version!());
        return;
    }

    let cli = Cli::parse();
    // ... rest of CLI logic
}
```

The `sw_cli::version!()` macro outputs:
```
Version: 0.1.0
Copyright (c) 2025 Your Name
MIT License: https://github.com/yourusername/my-cli/blob/main/LICENSE
Build: a84bf9a @ hostname (2025-11-23T21:48:21.062+00:00)
```

### 4. Help Text Integration

In `cli.rs`, the long help is integrated with clap:

```rust
#[derive(Parser, Debug)]
#[command(name = "my-cli")]
#[command(author = "Your Name")]
#[command(about = "Short description")]
#[command(long_about = sw_cli::long_help!())]
pub struct Cli {
    // ... CLI arguments
}
```

## File Structure

### Required Files

1. **`COPYRIGHT`** - Single line copyright notice
   ```
   Copyright (c) 2025 Your Name
   ```

2. **`src/short-help.txt`** - Brief help text for `-h`
   ```
   my-cli - Short description

   Usage: my-cli [OPTIONS]

   Options:
     -v, --verbose      Enable verbose output
     -h, --help         Print help
     -V, --version      Print version
   ```

3. **`src/long-help.txt`** - Detailed help text for `--help`
   ```
   my-cli - Short description

   Detailed description of what this CLI does...

   USAGE:
       my-cli [OPTIONS]

   OPTIONS:
       -v, --verbose
               Enable verbose output

   EXAMPLES:
       my-cli --verbose
   ```

4. **`Cargo.toml`** - Must include:
   ```toml
   [package]
   name = "my-cli"
   version = "0.1.0"
   license = "MIT"
   repository = "https://github.com/yourusername/my-cli"
   build = "build.rs"

   [dependencies]
   sw-cli = { path = "lib/sw-cli" }

   [build-dependencies]
   sw-cli = { path = "lib/sw-cli" }
   ```

5. **`.gitmodules`** - Submodule configuration
   ```
   [submodule "lib/sw-cli"]
       path = lib/sw-cli
       url = https://github.com/softwarewrighter/sw-cli.git
   ```

## Setup Process

### 1. Generate the CLI

```bash
cd cli-gen
cargo run -p cli-codegen-backend --bin cli_gen -- generate \
  --name my-cli \
  --short-desc "A brief description" \
  --long-desc "A longer description" \
  --author "Your Name" \
  --repository "https://github.com/yourusername/my-cli" \
  --license MIT \
  --output work/my-cli
```

### 2. Initialize the Project

```bash
cd work/my-cli
./scripts/setup.sh
```

This script:
- Initializes a git repository (if needed)
- Adds the sw-cli submodule
- Updates all submodules recursively

### 3. Build the Project

```bash
./scripts/build.sh
```

This script:
- Updates submodules to latest
- Runs `cargo build --release`
- Reports binary location

## Available Macros

### From sw-cli-macros

- **`version!()`** - Returns formatted version string with build info
- **`define_build_info!()`** - Generates build metadata at compile time
- **`define_help_info!()`** - Loads help text files at compile time
- **`short_help!()`** - Returns short help text
- **`long_help!()`** - Returns long help text
- **`dispatch!(...)`** - Creates a dispatcher with registered commands

## Example: Complete main.rs

```rust
use clap::Parser;
use my_cli::cli::Cli;

fn main() {
    // Check for version flag with detailed output
    let args: Vec<String> = std::env::args().collect();
    if args.len() > 1 && (args[1] == "-V" || args[1] == "--version") {
        println!("{}", sw_cli::version!());
        return;
    }

    let cli = Cli::parse();

    // Implement your CLI logic here
    if cli.verbose {
        println!("Running in verbose mode");
    }

    if cli.dry_run {
        println!("Dry-run mode - no changes will be made");
        return;
    }

    // ... rest of implementation
}
```

## Updating sw-cli

To update the sw-cli submodule to the latest version:

```bash
cd work/my-cli
git submodule update --remote --merge lib/sw-cli
git add lib/sw-cli
git commit -m "Update sw-cli to latest"
```

Or simply run the build script, which automatically updates:

```bash
./scripts/build.sh
```

## References

- [sw-cli Repository](https://github.com/softwarewrighter/sw-cli)
- [markdown-checker Example](https://github.com/softwarewrighter/markdown-checker) - Reference implementation
- [clap Documentation](https://docs.rs/clap/) - Argument parsing library
